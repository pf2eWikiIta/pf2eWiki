<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="wiki.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-light fixed-top shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="/index.html">
                <img src="/favicon.ico" alt="Home" width="30" height="24">
            </a>
            <span class="navbar-brand mb-0 h1">HOME</span>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse position-relative" id="navbarNavAltMarkup">
                <button class="btn btn-outline-success me-2" onclick='aggiorna("./razze.html?sezione=heritage")'>Torna agli heritage universali</button>
            </div>
        </div>
    </nav>

    <button class="btn btn-primary d-lg-none" id="sidebar-toggle" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas">
        â˜° Menu
    </button>
    <!-- Offcanvas Sidebar -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Navigazione</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <div id="sidebar-mobile" class="bg-light p-3 border rounded shadow-sm"></div>
        </div>
    </div>
    <div class="container-fluid p-3">
        <div class="row">
            <div class="col-lg-3 d-none d-lg-block border-end p-3 vh-100 overflow-auto" id ="sidebar-desktop-container">
                <div id="sidebar-desktop"></div>
                
            </div>
            <div class="col-lg-9 p-3" id = "contenitore">
                <div id = "heritage"></div> <br>
                <h2>Talenti:</h2>
                <div id = "talenti"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import * as common from './common.js';
        await common.init();
        const htmlSidebar = common.creaSidebar();
        const isMobile = window.matchMedia('(max-width: 767.98px)').matches;
        if (isMobile) {
            common.render(document.getElementById("sidebar-mobile"),htmlSidebar);
        } else {
            common.render(document.getElementById("sidebar-desktop"),htmlSidebar);
        }
        common.sBInit();

        const urlParams = new URLSearchParams(window.location.search);
        const idHer = urlParams.get('id');
        common.aprireSidebar(idHer);

        let pathHer = `./data/razze/heritage.json`;
        let pathTal = `./data/razze/talentiRazza.json`;

        let oggHer = await common.restituisciOggetto(pathHer, idHer);


        common.render(document.getElementById("heritage"), `
        <div class="card mb-3">
          <div class="card-body">
            <h3>-${oggHer.Nome}</h3>
            ${common.controllaTesto(oggHer.Dettagli)}<br><br>
            <strong>Benefici:</strong><br>
            ${common.controllaTesto(oggHer.Desc)}<br><br>
          ${common.htmlBottoneCopia(common.controllaTestoIncolla(oggHer.Desc))}
          </div>
        </div>`);

        const talenti = await common.restituisciDatoAttributi(pathTal, ["Razza"], [idHer]);
        for(let i = 0; i < talenti.length - 1; i++)
            for(let j = i + 1; j < talenti.length; j++) 
                if(parseInt(talenti[i].Livello) > parseInt(talenti[j].Livello)){
                    let temp = talenti[j];
                    talenti[j] = talenti[i];
                    talenti[i] = temp;
                }

        let risultato = talenti.map(t => `<div class="card mb-3">
        <div class="card-body">
          ${t.Azione? common.controllaTesto(t.Desc): 
          `<h3 id="${common.controllaTesto(t.Nome)}">${common.controllaTesto(t.Nome)}&nbsp;&nbsp;&nbsp;&nbsp;Livello ${t.Livello}</h3>
          ${common.creaGraficaTratti(t.Tratti)}
          <div>${common.controllaTesto(t.Desc)}</div>`}
          <br>
          ${common.htmlBottoneCopia(t.Azione? common.creaCopiaAzione(t.Desc): common.testoCopiaGenerico(t))}
        </div>
      </div>
      `).join("");

        let talOgg = document.getElementById("talenti");
        console.log(talOgg);
        common.render(talOgg, risultato);
        
        
        window.aggiorna= function(url) {
            common.aggiornaUrl(url);
        }
        // Funzione placeholder per il submit
        window.cerca = (valore) => {
            common.sBCerca(valore);
        };

        window.copia = (testo) => {
            common.copiaTesto(testo);
        }
    </script>
</body>
</html>
