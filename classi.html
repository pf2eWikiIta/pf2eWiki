<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classi</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="wiki.css">
    <style>
        
        .class-card {
            border: 1px solid black;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            background-color: white;
            transition: transform 0.2s;
        }

        .class-card:hover {
            transform: scale(1.03);
        }

        .class-card img {
            width: 100%;
            height: auto;
            object-fit: contain;
            padding: 0.5rem;
            flex-shrink: 0;
            flex-grow: 1;
        }

        .class-card h4, 
        .class-card h5 {
        font-size: clamp(0.6rem, 10vw, 1.2rem);
        /* 
            - minimo: 0.6rem (su schermi molto piccoli)
            - ideale: 1.5% della larghezza del viewport
            - massimo: 1.2rem (su desktop grandi non diventa enorme)
        */
        color: white;
        text-align: center;
        }

        .class-card {
            background-color: #3f3f3f; /* grigio chiaro */
            }

            

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-light fixed-top shadow-sm">
        <div class="container-fluid">
        <a class="navbar-brand" href="/index.html">
            <img src="/favicon.ico" alt="Home" width="30" height="24">
        </a>
        <span class="navbar-brand mb-0 h1">CLASSI</span>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
            <button class="btn btn-outline-success me-2" onclick='cambiaSezione("classes")'>Classi</button>
            <button class="btn btn-outline-success me-2" onclick='cambiaSezione("archetipi")'>Archetipi</button>
            </div>
        </div>
        </div>
    </nav>

    <button class="btn btn-primary d-lg-none" id="sidebar-toggle" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas">
        ☰ Menu
    </button>

    <!-- Offcanvas Sidebar -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Navigazione</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <div id="sidebar-mobile" class="bg-light p-3 border rounded shadow-sm"></div>
        </div>
    </div>
    <div class="container-fluid p-3">
        <div class="row">
            <div class="col-lg-3 d-none d-lg-block border-end p-3 vh-100 overflow-auto" id ="sidebar-desktop-container">
                <div id="sidebar-desktop"></div>
            </div>
            <div class="col-lg-9 p-3">
                <div id="classi" class="sezione">
                    <h2 class="mb-3">Classi</h2>
                    <div id="classi-container" class="row g-3"></div>
                </div>
                <div id="archetipi" class="sezione">
                    <h2 class="mb-3">Archetipi</h2>
                </div>
            </div>
        </div>
    </div>
    <script>
        
        const Classi = document.getElementById("classi");
        const Archetipi = document.getElementById("archetipi"); 

        function cambiaSezione(sezione) {
            Classi.classList.remove("attiva");
            Archetipi.classList.remove("attiva");

            switch (sezione) {
                case "classes":
                    Classi.classList.add("attiva");
                    break;
                case "archetipi":
                    Archetipi.classList.add("attiva");
                    break;
            }
        }
        document.addEventListener('click', function (e) {
    // Clic su un .btn o .nav-link dentro la collapse?
    const trigger = e.target.closest('#navbarNavAltMarkup .btn, #navbarNavAltMarkup .nav-link');
    if (!trigger) return;

    const menu = document.getElementById('navbarNavAltMarkup');
    if (!menu) return;

    // Se non è aperto, non fare nulla
    if (!menu.classList.contains('show')) return;

    // Chiudi SEMPRE l'istanza (creandola se serve)
    const bsCollapse = bootstrap.Collapse.getOrCreateInstance(menu);
    bsCollapse.hide();
    });
    </script>
    <script type="module">
        function creaCard(nome) {
            console.log(nome);
            const col = document.createElement('div');
            col.className = 'col-6 col-sm-4 col-md-3 col-lg-2';

            const card = document.createElement('div');
            card.className = 'card class-card h-100';
            card.onclick = () => window.location.href = common.restituisciLink(nome);

            const img = document.createElement('img');
            img.src = `./immagini/${nome.toLowerCase()}.png`;
            img.className = 'card-img-top';
            img.alt = nome;

            const title = document.createElement('h4');
            title.className = 'card-title text-center m-0 p-2';
            title.innerText = nome;
           // title.className = "nomeClasse";

            const body = document.createElement('div');
            body.className = 'card-body p-2 d-flex align-items-center justify-content-center';
            body.appendChild(title);

            card.appendChild(img);
            card.appendChild(body);

            col.appendChild(card);

            

            return col;
        }

        import * as common from './common.js';
        await common.init();
        const htmlSidebar = common.creaSidebar();
        const isMobile = window.matchMedia('(max-width: 767.98px)').matches;
        if (isMobile) {
        // Gestione sidebar mobile
        common.render(document.getElementById("sidebar-mobile"),htmlSidebar);
        } else {
        // Gestione sidebar desktop
        common.render(document.getElementById("sidebar-desktop"),htmlSidebar);
        }
        common.aprireSidebar("classi");
        cambiaSezione("classi");
        let classi = await common.trovaDati("classi/classes.json", ["Nome"]);
        classi = classi[0];
        const container = document.getElementById("classi-container");
        for(let i = 0; i < classi.length - 1; i++)
            for(let j = i + 1; j < classi.length; j++)
                if(classi[i] > classi[j]) {
                    let temp = classi[i];
                    classi[i] = classi[j];
                    classi[j] = temp;
                }

        for(let i = 0; i < classi.length; i++) {
            const card = creaCard(classi[i]);
            container.appendChild(card);
        };

        let dedication = await common.restituisciDatoAttributi("./data/classi/archetipi.json", ["Tratti"], ["Dedicazione"]);
        let listaDedication = "";
        for(let i = 0; i < dedication.length-1; i++)
            for(let j = i+1; j < dedication.length; j++)
                if(dedication[i].Nome > dedication[j].Nome) {
                    let temp = dedication[i];
                    dedication[i] = dedication[j];
                    dedication[j] = temp;
                }
        for(let i = 0; i < dedication.length; i++) {
            listaDedication += `<div class="card mb-3">
                <div class="card-body">
                    <h3 id="${dedication[i].Nome}">${common.controllaTesto(common.vR(dedication[i].Nome))}&nbsp;&nbsp;&nbsp;&nbsp;Livello ${dedication[i].LivArc}</h3>
                        ${common.controllaTesto(dedication[i].DescArc)}<br><br>
                    </div>
                </div>`;
        }

        common.render(Archetipi, listaDedication, true);

        const urlParams = new URLSearchParams(window.location.search);
        const sez = urlParams.get('sezione');
        
        cambiaSezione(sez == null? "classes" : sez);
        common.sBInit();
window.cerca = (valore) => {
            common.sBCerca(valore);
        };

        window.copia = (testo) => {
            common.copiaTesto(testo);
        }
    </script>
</body>
</html>